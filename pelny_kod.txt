--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Program.cs ---
using HomeBudgetProject.Classes;
using HomeBudgetProject.Enums;

namespace HomeBudgetProject
{
    internal class Program
    {
        static void Main(string[] args)
        {
            Display display = new Display();
            UserManager userManager = new UserManager();
            
            while (true)
            {
                User loggedUser = display.ShowLoginScreen(userManager);

                HomeBudgetPlanner planner = new HomeBudgetPlanner(loggedUser.Nickname);

                planner.Attach(display);
                planner.Attach(new AutoRaportUpdater());

                HomeBudgetPlannerProxy proxy = new HomeBudgetPlannerProxy(loggedUser, planner);

                display.MainMenu(loggedUser, proxy);
            }
            
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\AutoRaportUpdater.cs ---
using HomeBudgetProject.Interfaces;

namespace HomeBudgetProject.Classes
{
    internal class AutoRaportUpdater : IBudgetObserver
    {
        public void Update(HomeBudgetPlanner planer)
        {
            Console.WriteLine("System: Wykryto zmiany, aktualizuję raport automatyczny...");
            var autoStrategy = new CSVRaportStrategy();
            autoStrategy.GenerateRaport(planer);
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\BudgetGroup.cs ---
using System.Text;

namespace HomeBudgetProject.Classes
{
    public class BudgetGroup : BudgetItem
    {
        public List<BudgetItem> budgetItemList { get; set; } = new List<BudgetItem>();
        string Category;

        public BudgetGroup(string name, string category): base(name, 0)
        {
            Category = category;
        }

        public void Add(BudgetItem item)
        {
            budgetItemList.Add(item);
        }

        public void Remove(BudgetItem item)
        {
            budgetItemList.Remove(item);
        }
        public override float GetValue()
        {
            float total = 0;
            foreach (var item in budgetItemList)
            {
                total += item.GetValue();
            }
            return total;
        }

        public float GetIncome()
        {
            float income = 0;
            foreach (BudgetItem item in budgetItemList)
            {
                if (item is Income)
                {
                    income += item.GetValue();
                }
            }
            return income;
        }

        public float GetExpense()
        {
            float expense = 0;
            foreach (BudgetItem item in budgetItemList)
            {
                if (item is Expense)
                {
                    expense += item.GetValue();
                }
            }
            return expense;
        }


        public override string ToString()
        {
            StringBuilder sb = new StringBuilder();

            sb.Append($"[{Name}] - ĹÄ…cznie: {GetValue()} zĹ‚");

            foreach (BudgetItem item in budgetItemList)
            {
                string childText = item.ToString();
                string indentedChild = "\n\t" + childText.Replace("\n", "\n\t");
                sb.Append(indentedChild);
            }

            return sb.ToString();
        }


    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\BudgetItem.cs ---
using System.Text.Json.Serialization;
namespace HomeBudgetProject.Classes
{
    [JsonDerivedType(typeof(Expense), "Expense")]
    [JsonDerivedType(typeof(Income), "Income")]
    [JsonDerivedType(typeof(BudgetGroup), "Group expense")]
    public abstract class BudgetItem
    {
        
        public string Name { get; set; }
        public float Value { get; set; }
        public DateTime Date { get; set; }
        public BudgetItem(string name, float value)
        {
            Name = name;
            Value = value;
            Date = DateTime.Now;
        }

        public abstract float GetValue();

        public override string ToString()
        {
            return $"{Name}  {Value}\n";
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\CSVRaportStrategy.cs ---
using HomeBudgetProject.Interfaces;
using System.Text;

namespace HomeBudgetProject.Classes
{
    public class CSVRaportStrategy : IRaportStrategy
    {
        public void GenerateRaport(HomeBudgetPlanner planner)
        {
            var sb = new StringBuilder();
            sb.AppendLine("Type,Name,Value");

            foreach (var item in planner.budgetItemsList)
            {
                AppendItem(sb, item);
            }

            File.WriteAllText("budget_report.csv", sb.ToString());
            Console.WriteLine("Raport CSV zapisany: budget_report.csv");
        }

        private void AppendItem(StringBuilder sb, BudgetItem item)
        {
            if (item is BudgetGroup group)
            {
                sb.AppendLine($"Group,{group.Name},{group.GetValue()}");

                foreach (var subItem in group.budgetItemList)
                {
                    AppendItem(sb, subItem);
                }
            }
            else
            {
                sb.AppendLine($"{item.GetType().Name},{item.Name},{item.GetValue()}");
            }
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\Display.cs ---
using System.Data;
using HomeBudgetProject.Classes;
using HomeBudgetProject.Enums;
using HomeBudgetProject.Interfaces;

namespace HomeBudgetProject.Classes
{
    internal class Display : IBudgetObserver
    {
        Logger logger = Logger.GetInstance();

        public void Update(HomeBudgetPlanner planner)
        {
            Console.WriteLine("[POWIADOMIENIE] Dokonano zmian w budżecie.");
        }

        // EKRAN LOGOWANIA
        public User ShowLoginScreen(UserManager userManager)
        {
            User? selectedUser = null;

            while (selectedUser == null)
            {
                Console.Clear();
                Console.WriteLine("\t\tAPLIKACJA BUDŻETU DOMOWEGO\n");
                
                ShowMenu(new List<MenuOption>
                {
                    new MenuOption("Wypróbuj jako gość", () => {
                        selectedUser = new User("guest", "guest", StatusLevel.Guest);
                    }),
                    new MenuOption("Zaloguj się", () => {
                        selectedUser = Login(userManager);
                    }),
                    new MenuOption("Zarejestruj się", () => {
                        Register(userManager);
                    }),
                    new MenuOption("Zakończ", () => Environment.Exit(0))
                });
            }

            return selectedUser;
        }

        // LOGOWANIE 
        public User? Login(UserManager userManager)
        {
            Console.Clear();
            Console.WriteLine("[LOGOWANIE]");
            Console.Write("Podaj nazwę: ");
            string login = Console.ReadLine() ?? "";
            Console.Write("Podaj hasło: ");
            string password = Console.ReadLine() ?? "";

            User? authenticatedUser = userManager.Authenticate(login, password);

            if (authenticatedUser != null)
            {
                return authenticatedUser;
            }
            else
            {
                Console.WriteLine("Błędny login lub hasło! Naciśnij dowolny klawisz.");
                Console.ReadKey();
                return null;
            }
        }

        // REJESTRACJA
        public void Register(UserManager userManager)
        {
            Console.Clear();
            Console.WriteLine("[REJESTRACJA]");
            
            string login = "";
            while (login.Length < 3)
            {
                Console.Write("Nowa nazwa (min 3 znaki): ");
                login = Console.ReadLine() ?? "";
            }

            string password = "";
            while (password.Length < 6)
            {
                Console.Write("Nowe hasło (min 6 znaków): ");
                password = Console.ReadLine() ?? "";
            }

            Console.WriteLine("Wybierz poziom użytkownika:");
            Console.WriteLine("1. NormalUser");
            Console.WriteLine("2. VIP");
            Console.WriteLine("3. Admin");
            Console.Write("Twój wybór: ");
            string choice = Console.ReadLine() ?? "";

            StatusLevel level = StatusLevel.NormalUser;
            string? adminKey = null;

            switch (choice)
            {
                case "1":
                    level = StatusLevel.NormalUser;
                    break;
                case "2":
                    Console.Write("Wpisz 'Kupuję VIP' aby potwierdzić: ");
                    if (Console.ReadLine() == "Kupuję VIP")
                    {
                        level = StatusLevel.VIP;
                    }
                    else
                    {
                        Console.WriteLine("Anulowano. Naciśnij klawisz.");
                        Console.ReadKey();
                        return;
                    }
                    break;
                case "3":
                    level = StatusLevel.Admin;
                    Console.Write("Podaj hasło autoryzacyjne obecnego administratora: ");
                    adminKey = Console.ReadLine();
                    break;
                default:
                    Console.WriteLine("Nieprawidłowy wybór.");
                    Console.ReadKey();
                    return;
            }

            bool success = userManager.RegisterUser(login, password, level, adminKey);

            if (success)
            {
                Console.WriteLine("Zarejestrowano pomyślnie! Możesz się teraz zalogować.");
            }
            else
            {
                Console.WriteLine("Błąd rejestracji (login zajęty lub złe hasło admina).");
            }
            Console.ReadKey();
        }

        // MENU GŁÓWNE
        public void MainMenu(User user, HomeBudgetPlannerProxy proxy)
        {

            bool running = true;
            while (running)
            {
                Console.Clear();
                Console.WriteLine("\t\tAPLIKACJA BUDŻETU DOMOWEGO\n");
                Console.WriteLine($"\nWitaj! {user.Nickname} [{user.Status}]\n");

                ShowMenu(new List<MenuOption>
                {
                    new MenuOption("Dodaj Wydatek", () => AddExpenseMenu(proxy)),
                    new MenuOption("Dodaj Przychód", () => AddIncomeMenu(proxy)),
                    new MenuOption("Dodaj grupę budzetową", () => AddGroupMenu(proxy)),
                    new MenuOption("Pokaż budżet", () => ShowPlan(proxy)),
                    new MenuOption("Usuń element", () => RemoveItemMenu(proxy)),
                    new MenuOption("Zapisz raport do pliku", () => GenerateReportMenu(proxy)),
                    new MenuOption("Wyloguj", () => {running = false;})
                });
            }
        }

        // DODAWANIE WYDATKÓW
        private void AddExpenseMenu(HomeBudgetPlannerProxy proxy)
        {
            Console.Clear();
            Console.WriteLine("\t\tAPLIKACJA BUDŻETU DOMOWEGO\n");
            Console.WriteLine("[DODAWANIE WYDATKU]\n");

            Console.Write("Podaj nazwę wydatku: ");
            string name = Console.ReadLine()!;

            Console.Write("Podaj kwote: ");
            string text = Console.ReadLine()!;
            if(int.TryParse(text, out int value))
            {
                proxy.AddExpense(new Expense(name, value));
                Console.WriteLine("Dodano wydatek");
            }
            else
            {
                Console.WriteLine("Błąd");
                return;
            }
        }

        // DODAWANIE WYDATKÓW
        private void AddIncomeMenu(HomeBudgetPlannerProxy proxy)
        {
            Console.Clear();
            Console.WriteLine("\t\tAPLIKACJA BUDŻETU DOMOWEGO\n");
            Console.WriteLine("[DODAWANIE PRZYCHODU]\n");

            Console.Write("Podaj nazwę przychodu: ");
            string name = Console.ReadLine()!;

            Console.Write("Podaj kwote: ");
            string text = Console.ReadLine()!;
            if(int.TryParse(text, out int value))
            {
                proxy.AddIncome(new Income(name, value));
                Console.WriteLine("Dodano przychód");
            }
            else
            {
                Console.WriteLine("Błąd");
                return;
            }
        }

        // DODAWANIE GRUP
        private void AddGroupMenu(HomeBudgetPlannerProxy proxy)
        {
            Console.Clear();
            Console.WriteLine("\t\tAPLIKACJA BUDŻETU DOMOWEGO\n");
            Console.WriteLine("[KREOWANIE GRUPY]\n");

            Console.Write("Podaj nazwę grupy: ");
            string name = Console.ReadLine()!;

            Console.Write("Określ kategorię: ");
            string category = Console.ReadLine()!;

            BudgetGroup group = new BudgetGroup(name, category);
            
            bool running = true;

            while (running)
            {
                ShowMenu(new List<MenuOption>
                {
                    new MenuOption("Dodaj Wydatek", () => AddExpenseToGroup(group)),
                    new MenuOption("Dodaj Przychód", () => AddIncomeToGroup(group)),
                    new MenuOption("Dodaj Podgrupę", () => AddGroupMenu(proxy)),
                    new MenuOption("Zakończ", () => running = false)
                });
            }
        }

        // DODAWANIE WYDATKU DO GRUPY
        private void AddExpenseToGroup(BudgetGroup group)
        {
            Console.Clear();
            Console.Write("Podaj nazwę wydatku: ");
            string name = Console.ReadLine()!;

            Console.Write("Podaj kwote: ");
            string text = Console.ReadLine()!;
            if(int.TryParse(text, out int value))
            {
                group.Add(new Expense(name, value));
                Console.WriteLine("Dodano wydatek");
            }
            else
            {
                Console.WriteLine("Błąd");
                return;
            }
        }
        // DODAWANIE PRZYCHODU DO GRUPY
        private void AddIncomeToGroup(BudgetGroup group)
        {
            Console.Clear();
            Console.Write("Podaj nazwę przychodu: ");
            string name = Console.ReadLine()!;

            Console.Write("Podaj kwote: ");
            string text = Console.ReadLine()!;
            if(int.TryParse(text, out int value))
            {
                group.Add(new Income(name, value));
                Console.WriteLine("Dodano przychód");
            }
            else
            {
                Console.WriteLine("Błąd");
                return;
            }
        }

private void RemoveItemMenu(HomeBudgetPlannerProxy proxy)
{
    Console.Clear();
    Console.WriteLine("[USUWANIE ELEMENTU]\n");

    var items = proxy.GetBudgetItems();

    if (items.Count == 0)
    {
        Console.WriteLine("Brak elementów do usunięcia.");
        Console.ReadKey();
        return;
    }

    for (int i = 0; i < items.Count; i++)
    {
        Console.WriteLine($"{i + 1}. {items[i]}");
    }

    Console.Write("\nWybierz numer elementu do usunięcia: ");
    if (!int.TryParse(Console.ReadLine(), out int choice) ||
        choice < 1 || choice > items.Count)
    {
        Console.WriteLine("Nieprawidłowy wybór.");
        Console.ReadKey();
        return;
    }

    var item = items[choice - 1];

    bool success = proxy.RemoveItem(item);

    if (success)
    {
        Console.WriteLine("Element usunięty.");
    }
    else
    {
        Console.WriteLine("Operacja nie powiodła się.");
    }

    Console.ReadKey();
}



        

        // MENU BUDŻETU
        public void ShowPlan(HomeBudgetPlannerProxy proxy)
        {
                Console.Clear();
                Console.WriteLine("\t\tAPLIKACJA BUDŻETU DOMOWEGO\n");
                Console.WriteLine("[STAN BUDŻETU]\n");
                float totalExpenses = proxy.GetTotalExpense();
                float totalIncome = proxy.GetTotalIncome();
                float balance = proxy.GetBalance();

                Console.WriteLine($"\t\tObecny balans: {balance} zł\n");

                ShowMenu(new List<MenuOption>
            {
                new MenuOption($"Pokaż wydatki  (Łącznie: {totalExpenses} zł)", () => ShowExpensesList(proxy)),
                new MenuOption($"Pokaż przychody (Suma: {totalIncome} zł)", () => ShowIncomesList(proxy)),
                new MenuOption("Wróć", () => { })

            });

        }

        // WYŚWIETLANIE WYDATKÓW
        private void ShowExpensesList(HomeBudgetPlannerProxy proxy)
        {
            Console.Clear();
            Console.WriteLine("[SZCZEGÓŁY WYDATKÓW]\n");

            bool empty = true;
            foreach (var item in proxy.GetBudgetItems())
            {
                if (!(item is Income))
                {
                    Console.WriteLine(item);
                    empty = false;
                }
            }

            if (empty)
            {
                Console.WriteLine("Brak wydatków.");
            }

            Console.WriteLine("\nNaciśnij dowolny przycisk aby wrócić.");
            Console.ReadKey();
        }

        // WYŚWIETLANIE PRZYCHODÓW
        private void ShowIncomesList(HomeBudgetPlannerProxy proxy)
        {
            Console.Clear();
            Console.WriteLine("[SZCZEGÓŁY PRZYCHODÓW]\n");

            bool empty = true;
            foreach (var item in proxy.GetBudgetItems())
            {
                if (item is Income)
                {
                    Console.WriteLine(item);
                    empty = false;
                }
            }

            if (empty)
            {
                Console.WriteLine("Brak przychodów.");
            }

            Console.WriteLine("\nNaciśnij dowolny przycisk aby wrócić.");
            Console.ReadKey();
        }



        // WYBÓR FORMATU PLIKU
        private void GenerateReportMenu(HomeBudgetPlannerProxy proxy)
        {
            Console.Clear();
            Console.WriteLine("\t\tAPLIKACJA BUDŻETU DOMOWEGO\n");
            Console.WriteLine("[GENEROWANIE RAPORTU DO PLIKU]\n");
            Console.WriteLine("Wybierz format pliku:");
            ShowMenu(new List<MenuOption>
            {
                new MenuOption("Zapisz jako .PDF", () =>
                {
                    proxy.SetStrategy(new PDFRaportStrategy());
                    proxy.GenerateRaport();
                    Console.WriteLine("\nNaciśnij dowolny klawisz.");
                    Console.ReadKey();
                }),
                new MenuOption("Zapisz jako .CSV", () =>
                {
                    proxy.SetStrategy(new CSVRaportStrategy());
                    proxy.GenerateRaport();
                    Console.WriteLine("\nNaciśnij dowolny klawisz.");
                    Console.ReadKey();
                }),
                new MenuOption("Wróć", () => { }) 
            });

        }

        // METODA POMOCNICZA DO WYŚWIETLANIA MENU
        public void ShowMenu(List<MenuOption> options)
        {

            Console.WriteLine("Wybierz opcję:");
            for (int i = 0; i < options.Count; i++)
            {
                Console.WriteLine($"{i + 1}. {options[i].Description}");
            }

            if (int.TryParse(Console.ReadLine(), out int choice) && choice > 0 && choice <= options.Count)
            {
                options[choice - 1].Action?.Invoke();   
            }
            else
            {
                Console.WriteLine("Nieprawidłowy wybór.");
            }
        }
      

    }

    public class MenuOption
    {
        public string? Description {get; set;}
        public Action? Action {get; set;}

        public MenuOption(string description, Action action)
        {
            Description = description;
            Action = action;
        }
    }

}


--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\Expense.cs ---
namespace HomeBudgetProject.Classes
{
    public class Expense : BudgetItem
    {
        public Expense(string name, float value): base(name, value) {}
        public override float GetValue()
        {
            return Value;
        }
        public override string ToString()
        {
            return $"{Name} - {Value} zł  [{Date:dd-MM-yyyy}]";
        }

    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\HomeBudgetPlanner.cs ---
using HomeBudgetProject.Interfaces;
using System.Text.Json;
using System.IO;
using System.Text;

namespace HomeBudgetProject.Classes
{
    public class HomeBudgetPlanner : IHomeBudgetPlanner
    {
        private readonly string filePath;
        private List<IBudgetObserver> observers = new List<IBudgetObserver>();
        public List<BudgetItem> budgetItemsList = new List<BudgetItem>();
        public IRaportStrategy raportStrategy;
public HomeBudgetPlanner(string nickname)
{
    filePath = $"budget_{nickname}.json";
    LoadBudget();
}

        public void AddExpense(Expense item)
        {
            budgetItemsList.Add(item);
            Notify();
            SaveBudget();
        }

        public void AddIncome(Income item)
        {
            budgetItemsList.Add(item);
            Notify();
            SaveBudget();
        }

        public void AddGroup(BudgetGroup group)
        {
            BudgetGroup exist = null;

            foreach (var item in budgetItemsList)
            {
                if (item is BudgetGroup groupToCheck)
                {
                    //ignorujemy spacje i wielkosc liter
                    string name1 = groupToCheck.Name.Trim().ToLower();
                    string name2 = group.Name.Trim().ToLower();

                    if (name1 == name2)
                    {
                        exist = groupToCheck;
                        break;
                    }
                }
            }

            if (exist != null)
            {
                MergeSubGroups(exist, group);
            }
            else
            {
                budgetItemsList.Add(group);
            }
            Notify();
            SaveBudget();
        }
        public bool RemoveItem(BudgetItem item)
{
    bool removed = budgetItemsList.Remove(item);

    if (removed)
    {
        Notify();
        SaveBudget();
    }

    return removed;
}



        //metoda potrzebna żeby łączyć podkategorie
        private void MergeSubGroups(BudgetGroup existingGroup, BudgetGroup newGroup)
        {
            foreach (var newItem in newGroup.budgetItemList)
            {
                if (newItem is BudgetGroup newSubGroup)
                {

                    BudgetGroup existingSubGroup = null;

                    foreach (var existingItem in existingGroup.budgetItemList)
                    {
                        if (existingItem is BudgetGroup groupToCheck)
                        {
                            //ignorujemy spacje i wielkość liter 
                            string name1 = groupToCheck.Name.Trim().ToLower();
                            string name2 = newSubGroup.Name.Trim().ToLower();

                            if (name1 == name2)
                            {
                                existingSubGroup = groupToCheck;
                                break;
                            }
                        }
                    }

                    if (existingSubGroup != null)
                    {
                        MergeSubGroups(existingSubGroup, newSubGroup);
                    }
                    else
                    {
                        existingGroup.Add(newSubGroup);
                    }
                }
                else
                {
                    existingGroup.Add(newItem);
                }
            }
        }

        public float GetTotalIncome()
        {
            float total = 0;
            foreach (var item in budgetItemsList)
            {
                if (item is Income)
                {
                    total += item.GetValue();
                }
            }

            return total;
        }

public float GetTotalExpense()
{
    float total = 0;

    foreach (var item in budgetItemsList)
    {
        if (item is Expense)
        {
            total += item.GetValue();
        }
    }

    return total;
}


        public float GetBalance()
        {
            return GetTotalIncome() - GetTotalExpense();
        }

        public List<BudgetItem> GetBudgetItems()
        {
            return budgetItemsList;
        }

        public void Attach(IBudgetObserver observer)
        {
            if (!observers.Contains(observer))
            {
                observers.Add(observer);
            }
        }

        public void Detach(IBudgetObserver observer)
        {
            observers.Remove(observer);
        }

        public void GenerateRaport()
        {
            if (raportStrategy == null)
            {
                throw new InvalidOperationException("Nie ustawiono strategii raportowania!");
            }
            raportStrategy.GenerateRaport(this);
        }

        public void Notify()
        {
            foreach (var observer in observers)
            {
                observer.Update(this);
            }
        }

        public void SetStrategy(IRaportStrategy strategy)
        {
            this.raportStrategy = strategy;
        }

        //obsługa Json

        private void LoadBudget()
        {
            if (File.Exists(filePath) == false) { return; }
            try
            {
                string json = File.ReadAllText(filePath, Encoding.UTF8);
                List<BudgetItem> lista = JsonSerializer.Deserialize<List<BudgetItem>>(json);
                if (lista != null)
                {
                    budgetItemsList = lista;
                }
            }
            catch
            {
                budgetItemsList = new List<BudgetItem>();
            }
        }
        private void SaveBudget()
        {
            JsonSerializerOptions option = new JsonSerializerOptions();
            option.WriteIndented = true;
            option.Encoder = System.Text.Encodings.Web.JavaScriptEncoder.UnsafeRelaxedJsonEscaping;

            string content = JsonSerializer.Serialize(budgetItemsList, option);
            File.WriteAllText(filePath, content, Encoding.UTF8);
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\HomeBudgetPlannerProxy.cs ---
using HomeBudgetProject.Enums;
using HomeBudgetProject.Interfaces;

namespace HomeBudgetProject.Classes
{
    internal class HomeBudgetPlannerProxy : IHomeBudgetPlanner
    {
        private HomeBudgetPlanner _realService;
        private User user;

        private Logger logger;

        public HomeBudgetPlannerProxy(User user, HomeBudgetPlanner service)
        {
            this.user = user;
            _realService = service;
            logger = Logger.GetInstance();
        }

public void AddExpense(Expense item)
{
    _realService.AddExpense(item);

    if (user.Status == StatusLevel.Guest)
    {
        logger.Log(LogType.SuccessfulOperation, user, $"[DEMO] Dodano wydatek: {item.Name}");
    }
    else
    {
        logger.Log(LogType.SuccessfulOperation, user, $"Dodano wydatek: {item.Name}");
    }
}


        public void AddIncome(Income item)
        {
            _realService.AddIncome(item);
            logger.Log(LogType.SuccessfulOperation, user, $"Dodano nowy przychód");
        }

        public void AddGroup(BudgetGroup group)
        {
            _realService.AddGroup(group);
            logger.Log(LogType.SuccessfulOperation, user, $"Dodano nową grupę");
        }

        public bool RemoveItem(BudgetItem item)
{
    if (user.Status == StatusLevel.Guest)
    {
        Console.WriteLine("Gość nie może usuwać elementów.");
        logger.Log(LogType.FailedOperation, user, "Próba usunięcia elementu przez gościa");
        return false;
    }

    bool result = _realService.RemoveItem(item);

    if (result)
    {
        logger.Log(LogType.SuccessfulOperation, user, $"Usunięto element: {item.Name}");
    }
    else
    {
        logger.Log(LogType.FailedOperation, user, $"Nie udało się usunąć elementu: {item.Name}");
    }

    return result;
}


        public float GetTotalIncome()
        {
            return _realService.GetTotalIncome();
        }

        public float GetTotalExpense()
        {
             return _realService.GetTotalExpense();
        }
        public float GetBalance()
        {
             return _realService.GetBalance();
        }
        public List<BudgetItem> GetBudgetItems()
        {
            return _realService.GetBudgetItems();
        }

        public void Attach(IBudgetObserver observer)
        {
            _realService.Attach(observer);
        }

        public void Detach(IBudgetObserver observer)
        {
            _realService.Detach(observer);
        }

        public void Notify()
        {
            _realService.Notify();
        }

        public void GenerateRaport()
        {
            if (!HasPermission(nameof(GenerateRaport)))
            {
                Console.WriteLine("Nie masz uprawnień do generowania raportu");
                logger.Log(LogType.FailedOperation, user, "Nie posiada uprawnień do generowania raportu");
                return;
            }
            _realService.GenerateRaport();
            logger.Log(LogType.SuccessfulOperation, user, $"Wygenerowano raport {_realService.raportStrategy}");
       
        }

        public void SetStrategy(IRaportStrategy strategy)
        {
            if (!HasPermission(nameof(SetStrategy)))
            {
                Console.WriteLine("Nie masz uprawnień do zmiany formatu raportu");
                logger.Log(LogType.FailedOperation, user, "Nie posiada uprawnień do zmiany formatu raportu");
                return;
            }
            _realService.SetStrategy(strategy);
            logger.Log(LogType.SuccessfulOperation, user, $"Ustawiono format raportu na {strategy}");
        }

        private bool HasPermission(string methodName)
        {
            switch (methodName)
            {
                case "GenerateRaport":
                    if (user.Status < StatusLevel.NormalUser)
                    {
                        return false;
                    }
                    break;
                case "SetStrategy":
                    if (user.Status < StatusLevel.VIP)
                    {
                        return false;
                    }
                    break;
            }
            return true;
        }

        public HomeBudgetPlanner GetRealService()
        {
            return _realService;
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\Income.cs ---
namespace HomeBudgetProject.Classes
{
    public class Income : BudgetItem
    {
        public Income(string name, float value): base(name, value) {}
        public override float GetValue()
        {
            return Value;
        }
        public override string ToString()
        {
            return $"Przychód: {Name} - {Value} zł  [{Date:dd-MM-yyyy}]";
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\Log.cs ---
using HomeBudgetProject.Enums;

namespace HomeBudgetProject.Classes
{
    internal class Log
    {
        public LogType logType { get; set; }
        public User user { get; set; }
        public string? description { get; set; }

        public Log(LogType logType, User user, string description)
        {
            this.logType = logType;
            this.user = user;
            this.description = description;
        }

        public override string ToString()
        {
            return $"[{logType}] {user.Nickname} {description}";
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\Logger.cs ---
using HomeBudgetProject.Enums;
using System.Text.Json;

namespace HomeBudgetProject.Classes
{
    internal class Logger
    {
        private string filePath = "system_logs.json";
        private static Logger? _instance;
        private List<Log> logEntries;

        private Logger() {
            logEntries = LoadLogs();
        }

        public static Logger GetInstance()
        {
            if (_instance == null)
            {
                _instance = new Logger();
            }

            return _instance;
        }
        public void Log(LogType logType, User user, string description)
        {
            logEntries.Add(new Log(logType, user, description));
            SaveLogs();
        }

        public void GetLogsForAdmin(User currentUser)
        {
            if (currentUser.Status != StatusLevel.Admin)
            {
                Console.WriteLine("Brak uprawnieďż˝ do przeglďż˝dania logďż˝w systemowych!");
                return;
            }

            int number = 1;
            foreach (Log log in logEntries)
            {
                Console.WriteLine($"{number}. {log}");
                number++;
            }
        }
        private List<Log> LoadLogs()
        {
            if (File.Exists(filePath) == false) { return new List<Log>(); }
            try
            {
                string logs = File.ReadAllText(filePath, System.Text.Encoding.UTF8); //domyslnie bez polskichznakow
                List<Log> loadedLogs = JsonSerializer.Deserialize<List<Log>>(logs);  //Informacja na ďż˝ďż˝to ďż˝e moďż˝e byďż˝ null, ale poniďż˝ej sprawdzenie
                if(loadedLogs == null) {  return new List<Log>(); }
                return loadedLogs;
            }
            catch { return new List<Log>(); }
        }
        private void SaveLogs()
        {
            JsonSerializerOptions options = new JsonSerializerOptions();
            options.WriteIndented = true; // dla ďż˝adnego wyďż˝wietlania
            options.Encoder = System.Text.Encodings.Web.JavaScriptEncoder.UnsafeRelaxedJsonEscaping; //dodatkowo do utf-8
            string logs = JsonSerializer.Serialize(logEntries, options);
            File.WriteAllText(filePath, logs, System.Text.Encoding.UTF8);
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\PDFRaportStrategy.cs ---
using HomeBudgetProject.Interfaces;
using QuestPDF.Fluent;
using QuestPDF.Helpers;
using QuestPDF.Infrastructure;

namespace HomeBudgetProject.Classes
{
    public class PDFRaportStrategy : IRaportStrategy
    {
        public void GenerateRaport(HomeBudgetPlanner planner)
        {
            QuestPDF.Settings.License = LicenseType.Community;

            Document.Create(container =>
            {
                container.Page(page =>
                {
                    page.Size(PageSizes.A4);
                    page.Margin(40);
                    page.DefaultTextStyle(x => x.FontSize(12));

                    page.Content().Column(column =>
                    {
                        column.Item().Text("RAPORT BUDŻETU DOMOWEGO")
                            .FontSize(20)
                            .Bold()
                            .AlignCenter();

                        column.Item().PaddingVertical(10);

                        foreach (var item in planner.budgetItemsList)
                        {
                            RenderItem(column, item, 0);
                        }
                    });
                });
            })
            .GeneratePdf("budget_report.pdf");

            Console.WriteLine("Raport PDF zapisany: budget_report.pdf");
        }

        private void RenderItem(ColumnDescriptor column, BudgetItem item, int indent)
        {
            string prefix = new string(' ', indent * 4);

            if (item is BudgetGroup group)
            {
                column.Item().Text($"{prefix}[GRUPA] {group.Name} | SUMA: {group.GetValue()}")
                    .Bold();

                foreach (var subItem in group.budgetItemList)
                {
                    RenderItem(column, subItem, indent + 1);
                }
            }
            else
            {
                column.Item().Text($"{prefix}{item.Name} -> {item.GetValue()}");
            }
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\User.cs ---
using HomeBudgetProject.Enums;

namespace HomeBudgetProject.Classes
{
    public class User
    {
        public string Nickname { get; set; }
        public string Password { get; set; }
        public StatusLevel Status { get; set; }

        public User(string nickname, string password, StatusLevel level)
        {
            Nickname = nickname;
            Password = password;
            Status = level;
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\UserManager.cs ---
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Text.Json;
using System.Threading.Tasks;
using HomeBudgetProject.Enums;


namespace HomeBudgetProject.Classes
{
    public class UserManager
    {
        private const string FilePath = "users.json";
        private List<User> users;
        public User currentUser;

        public UserManager()
        {
            users = LoadUsers();

            bool adminFound = false;
            foreach (User u in users)
            {
                if (u.Nickname == "admin")
                {
                    adminFound = true;
                    break;
                }
            }

            if (adminFound == false)
            {
                users.Add(new User("admin", HashPaswd("admin"), StatusLevel.Admin));
                SaveUsers();
            }
        }

        private List<User> LoadUsers()
        {
            if (File.Exists(FilePath) == false)
            {
                return new List<User>();
            }

            try
            {
                string json = File.ReadAllText(FilePath, Encoding.UTF8);
                List<User> list = JsonSerializer.Deserialize<List<User>>(json);

                if (list == null)
                {
                    return new List<User>();
                }

                return list;
            }
            catch
            {
                return new List<User>();
            }
        }

        private void SaveUsers()
        {
            JsonSerializerOptions options = new JsonSerializerOptions();
            options.WriteIndented = true; //formatowanie w przystępny sposób

            string json = JsonSerializer.Serialize(users, options);
            File.WriteAllText(FilePath, json, System.Text.Encoding.UTF8);
        }

        public User Authenticate(string nickname, string password)
        {
            string hashedPassword = HashPaswd(password);

            foreach (User u in users)
            {
                if (u.Nickname == nickname && u.Password == hashedPassword)
                {
                    return u;
                }
            }
            return null;
        }

        public bool RegisterUser(string nickname, string password, StatusLevel level, string adminAuthPassword = null)
        {
            string hashedAdminAuthPassword;
            if (adminAuthPassword == null)
            {
                hashedAdminAuthPassword = adminAuthPassword;
            }
            else { hashedAdminAuthPassword = HashPaswd(adminAuthPassword); }

            bool exists = false;
            foreach (User u in users)
            {
                if (u.Nickname == nickname)
                {
                    exists = true;
                    break;
                }
            }

            if (exists == true)
            {
                return false;
            }

if (level == StatusLevel.Admin)
{
    if (string.IsNullOrEmpty(adminAuthPassword))
        return false;

    string hashedAdminAuthPassword = HashPaswd(adminAuthPassword);

    User admin = users.FirstOrDefault(u => u.Status == StatusLevel.Admin);

    if (admin == null || admin.Password != hashedAdminAuthPassword)
        return false;
}

            users.Add(new User(nickname, HashPaswd(password), level));
            SaveUsers();
            return true;
        }

        private string HashPaswd(string password) 
        {
            using (System.Security.Cryptography.SHA256 sha256 = System.Security.Cryptography.SHA256.Create())
            {
                byte[] bytes = Encoding.UTF8.GetBytes(password);
                byte[] hash = sha256.ComputeHash(bytes);
                return Convert.ToBase64String(hash);
            }
        }

        public void AddUser(string name, string pass, StatusLevel status)
        {
            currentUser = new User(name, pass, status);
            if (currentUser.Status != StatusLevel.Guest)
            {
                users.Add(currentUser);
                SaveUsers();
            }
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Enums\LogType.cs ---
namespace HomeBudgetProject.Enums
{
        public enum LogType
    {
        LogIn,
        LogOut,
        SuccessfulOperation,
        FailedOperation
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Enums\StatusLevel.cs ---
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace HomeBudgetProject.Enums
{
    public enum StatusLevel
    {
        Guest,
        NormalUser,
        VIP,
        Admin
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Interfaces\IBudgetObserver.cs ---
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using HomeBudgetProject.Classes;

namespace HomeBudgetProject.Interfaces
{
    public interface IBudgetObserver
    {
        void Update(HomeBudgetPlanner planer);
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Interfaces\IHomeBudgetPlanner.cs ---
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using HomeBudgetProject.Classes;

namespace HomeBudgetProject.Interfaces
{
    public interface IHomeBudgetPlanner
    {
        void AddIncome(Income item);
        void AddExpense(Expense item);
        void AddGroup(BudgetGroup group);
        bool RemoveItem(BudgetItem item);

        List<BudgetItem> GetBudgetItems();
        void GenerateRaport();
        void SetStrategy(IRaportStrategy strategy);
        void Attach(IBudgetObserver observer);
        void Detach(IBudgetObserver observer);
        void Notify();
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Interfaces\IRaportStrategy.cs ---
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using HomeBudgetProject.Classes;

namespace HomeBudgetProject.Interfaces
{
    public interface IRaportStrategy
    {
        void GenerateRaport(HomeBudgetPlanner planner);
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Program.cs ---
using HomeBudgetProject.Classes;
using HomeBudgetProject.Enums;

namespace HomeBudgetProject
{
    internal class Program
    {
        static void Main(string[] args)
        {
            Display display = new Display();
            UserManager userManager = new UserManager();
            
            while (true)
            {
                User loggedUser = display.ShowLoginScreen(userManager);

                HomeBudgetPlanner planner = new HomeBudgetPlanner(loggedUser.Nickname);

                planner.Attach(display);
                planner.Attach(new AutoRaportUpdater());

                HomeBudgetPlannerProxy proxy = new HomeBudgetPlannerProxy(loggedUser, planner);

                display.MainMenu(loggedUser, proxy);
            }
            
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\AutoRaportUpdater.cs ---
using HomeBudgetProject.Interfaces;

namespace HomeBudgetProject.Classes
{
    internal class AutoRaportUpdater : IBudgetObserver
    {
        public void Update(HomeBudgetPlanner planner)
        {
            if (planner.is_raport_generated == true)
            {
                var autoStrategy = new CSVRaportStrategy();
                autoStrategy.GenerateRaport(planner);
            }
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\BudgetGroup.cs ---
using System.Text;

namespace HomeBudgetProject.Classes
{
    public class BudgetGroup : BudgetItem
    {
        public List<BudgetItem> budgetItemList { get; set; } = new List<BudgetItem>();
        string Category;

        public BudgetGroup(string name, string category): base(name, 0)
        {
            Category = category;
        }

        public void Add(BudgetItem item)
        {
            budgetItemList.Add(item);
        }

        public void Remove(BudgetItem item)
        {
            budgetItemList.Remove(item);
        }
        public override float GetValue()
        {
            float total = 0;
            foreach (var item in budgetItemList)
            {
                total += item.GetValue();
            }
            return total;
        }

        public float GetIncome()
        {
            float income = 0;
            foreach (BudgetItem item in budgetItemList)
            {
                if (item is Income)
                {
                    income += item.GetValue();
                }
            }
            return income;
        }

        public float GetExpense()
        {
            float expense = 0;
            foreach (BudgetItem item in budgetItemList)
            {
                if (item is Expense)
                {
                    expense += item.GetValue();
                }
            }
            return expense;
        }


        public override string ToString()
        {
            StringBuilder sb = new StringBuilder();

            sb.Append($"[{Name}] - ĹÄ…cznie: {GetValue()} zĹ‚");

            foreach (BudgetItem item in budgetItemList)
            {
                string childText = item.ToString();
                string indentedChild = "\n\t" + childText.Replace("\n", "\n\t");
                sb.Append(indentedChild);
            }

            return sb.ToString();
        }


    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\BudgetItem.cs ---
using System.Text.Json.Serialization;
namespace HomeBudgetProject.Classes
{
    [JsonDerivedType(typeof(Expense), "Expense")]
    [JsonDerivedType(typeof(Income), "Income")]
    [JsonDerivedType(typeof(BudgetGroup), "Group expense")]
    public abstract class BudgetItem
    {
        
        public string Name { get; set; }
        public float Value { get; set; }
        public DateTime Date { get; set; }
        public BudgetItem(string name, float value)
        {
            Name = name;
            Value = value;
            Date = DateTime.Now;
        }

        public abstract float GetValue();

        public override string ToString()
        {
            return $"{Name} {Value}zł\n";
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\CSVRaportStrategy.cs ---
using HomeBudgetProject.Interfaces;
using System.Text;

namespace HomeBudgetProject.Classes
{
    public class CSVRaportStrategy : IRaportStrategy
    {
        public void GenerateRaport(HomeBudgetPlanner planner)
        {
            var sb = new StringBuilder();
            sb.AppendLine("Type,Name,Value");

            foreach (var item in planner.budgetItemsList)
            {
                AppendItem(sb, item);
            }

            File.WriteAllText("budget_report.csv", sb.ToString());
            Console.WriteLine("Raport CSV zapisany: budget_report.csv");
        }

        private void AppendItem(StringBuilder sb, BudgetItem item)
        {
            if (item is BudgetGroup group)
            {
                sb.AppendLine($"Group,{group.Name},{group.GetValue()}");

                foreach (var subItem in group.budgetItemList)
                {
                    AppendItem(sb, subItem);
                }
            }
            else
            {
                sb.AppendLine($"{item.GetType().Name},{item.Name},{item.GetValue()}");
            }
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\Display.cs ---
using System.Data;
using HomeBudgetProject.Classes;
using HomeBudgetProject.Enums;
using HomeBudgetProject.Interfaces;

namespace HomeBudgetProject.Classes
{
    internal class Display : IBudgetObserver
    {
        Logger logger = Logger.GetInstance();

        public void Update(HomeBudgetPlanner planner)
        {
            Console.WriteLine("[POWIADOMIENIE] Dokonano zmian w budżecie.");
        }

        // EKRAN LOGOWANIA
        public User ShowLoginScreen(UserManager userManager)
        {
            User? selectedUser = null;

            while (selectedUser == null)
            {
                Console.Clear();
                Console.WriteLine("\t\tAPLIKACJA BUDŻETU DOMOWEGO\n");
                
                ShowMenu(new List<MenuOption>
                {
                    new MenuOption("Wypróbuj jako gość", () => {
                        selectedUser = new User("guest", "guest", StatusLevel.Guest);
                    }),
                    new MenuOption("Zaloguj się", () => {
                        selectedUser = Login(userManager);
                    }),
                    new MenuOption("Zarejestruj się", () => {
                        Register(userManager);
                    }),
                    new MenuOption("Zakończ", () => Environment.Exit(0))
                });
            }

            return selectedUser;
        }

        // LOGOWANIE 
        public User? Login(UserManager userManager)
        {
            Console.Clear();
            Console.WriteLine("[LOGOWANIE]");
            Console.Write("Podaj nazwę: ");
            string login = Console.ReadLine() ?? "";
            Console.Write("Podaj hasło: ");
            string password = Console.ReadLine() ?? "";

            User? authenticatedUser = userManager.Authenticate(login, password);

            if (authenticatedUser != null)
            {
                return authenticatedUser;
            }
            else
            {
                Console.WriteLine("Błędny login lub hasło! Naciśnij dowolny klawisz.");
                Console.ReadKey();
                return null;
            }
        }

        // REJESTRACJA
        public void Register(UserManager userManager)
        {
            Console.Clear();
            Console.WriteLine("[REJESTRACJA]");
            
            string login = "";
            while (login.Length < 3)
            {
                Console.Write("Nowa nazwa (min. 3 znaki): ");
                login = Console.ReadLine() ?? "";
            }

            string password = "";
            while (password.Length < 6)
            {
                Console.Write("Nowe hasło (min. 6 znaków): ");
                password = Console.ReadLine() ?? "";
            }

            Console.WriteLine("Wybierz poziom użytkownika:");
            Console.WriteLine("1. NormalUser");
            Console.WriteLine("2. VIP");
            Console.WriteLine("3. Admin");
            Console.Write("Twój wybór: ");
            string choice = Console.ReadLine() ?? "";

            StatusLevel level = StatusLevel.NormalUser;
            string? adminKey = null;

            switch (choice)
            {
                case "1":
                    level = StatusLevel.NormalUser;
                    break;
                case "2":
                    Console.Write("Wpisz 'Kupuję VIP' aby potwierdzić: ");
                    if (Console.ReadLine() == "Kupuję VIP")
                    {
                        level = StatusLevel.VIP;
                    }
                    else
                    {
                        Console.WriteLine("Anulowano. Naciśnij klawisz.");
                        Console.ReadKey();
                        return;
                    }
                    break;
                case "3":
                    level = StatusLevel.Admin;
                    Console.Write("Podaj hasło autoryzacyjne obecnego administratora: ");
                    adminKey = Console.ReadLine();
                    break;
                default:
                    Console.WriteLine("Nieprawidłowy wybór.");
                    Console.ReadKey();
                    return;
            }

            bool success = userManager.RegisterUser(login, password, level, adminKey);

            if (success)
            {
                Console.WriteLine("Zarejestrowano pomyślnie! Możesz się teraz zalogować.");
            }
            else
            {
                Console.WriteLine("Błąd rejestracji (login zajęty lub złe hasło admina).");
            }
            Console.ReadKey();
        }

        // MENU GŁÓWNE
        public void MainMenu(User user, HomeBudgetPlannerProxy proxy)
        {

            bool running = true;
            while (running)
            {
                Console.Clear();
                Console.WriteLine("\t\tAPLIKACJA BUDŻETU DOMOWEGO\n");
                Console.WriteLine($"\nWitaj! {user.Nickname} [{user.Status}]\n");

                ShowMenu(new List<MenuOption>
                {
                    new MenuOption("Dodaj Wydatek", () => AddExpenseMenu(proxy)),
                    new MenuOption("Dodaj Przychód", () => AddIncomeMenu(proxy)),
                    new MenuOption("Dodaj grupę budzetową", () => AddGroupMenu(proxy)),
                    new MenuOption("Pokaż budżet", () => ShowPlan(proxy)),
                    new MenuOption("Usuń element", () => RemoveItemMenu(proxy)),
                    new MenuOption("Zapisz raport do pliku", () => proxy.GenerateRaport()),
                    new MenuOption("Zmień strategię zapisu", () => ChangeStrategyMenu(proxy)),
                    new MenuOption("Wyloguj", () => {running = false;})
                });
            }
        }

        // DODAWANIE WYDATKÓW
        private void AddExpenseMenu(HomeBudgetPlannerProxy proxy)
        {
            Console.Clear();
            Console.WriteLine("\t\tAPLIKACJA BUDŻETU DOMOWEGO\n");
            Console.WriteLine("[DODAWANIE WYDATKU]\n");

            Console.Write("Podaj nazwę wydatku: ");
            string name = Console.ReadLine()!;

            Console.Write("Podaj kwote: ");
            string text = Console.ReadLine()!;
            if(int.TryParse(text, out int value))
            {
                proxy.AddExpense(new Expense(name, value));
                Update(proxy.GetRealService());
                Console.WriteLine("Dodano wydatek");
            }
            else
            {
                Console.WriteLine("Błąd");
                return;
            }
        }

        // DODAWANIE WYDATKÓW
        private void AddIncomeMenu(HomeBudgetPlannerProxy proxy)
        {
            Console.Clear();
            Console.WriteLine("\t\tAPLIKACJA BUDŻETU DOMOWEGO\n");
            Console.WriteLine("[DODAWANIE PRZYCHODU]\n");

            Console.Write("Podaj nazwę przychodu: ");
            string name = Console.ReadLine()!;

            Console.Write("Podaj kwote: ");
            string text = Console.ReadLine()!;
            if(int.TryParse(text, out int value))
            {
                proxy.AddIncome(new Income(name, value));
                Console.WriteLine("Dodano przychód");
            }
            else
            {
                Console.WriteLine("Błąd");
                return;
            }
        }

        // DODAWANIE GRUP
        private void AddGroupMenu(HomeBudgetPlannerProxy proxy)
        {
            Console.Clear();
            Console.WriteLine("\t\tAPLIKACJA BUDŻETU DOMOWEGO\n");
            Console.WriteLine("[KREOWANIE GRUPY]\n");

            Console.Write("Podaj nazwę grupy: ");
            string name = Console.ReadLine()!;

            Console.Write("Określ kategorię: ");
            string category = Console.ReadLine()!;

            BudgetGroup group = new BudgetGroup(name, category);
            
            bool running = true;

            while (running)
            {
                ShowMenu(new List<MenuOption>
                {
                    new MenuOption("Dodaj Wydatek", () => AddExpenseToGroup(group)),
                    new MenuOption("Dodaj Przychód", () => AddIncomeToGroup(group)),
                    new MenuOption("Dodaj Podgrupę", () => AddGroupMenu(proxy)),
                    new MenuOption("Zakończ", () => {proxy.AddGroup(group); running = false;})
                });
            }
        }

        // DODAWANIE WYDATKU DO GRUPY
        private void AddExpenseToGroup(BudgetGroup group)
        {
            Console.Clear();
            Console.Write("Podaj nazwę wydatku: ");
            string name = Console.ReadLine()!;

            Console.Write("Podaj kwote: ");
            string text = Console.ReadLine()!;
            if(int.TryParse(text, out int value))
            {
                group.Add(new Expense(name, value));
                Console.WriteLine("Dodano wydatek");
            }
            else
            {
                Console.WriteLine("Błąd");
                return;
            }
        }
        // DODAWANIE PRZYCHODU DO GRUPY
        private void AddIncomeToGroup(BudgetGroup group)
        {
            Console.Clear();
            Console.Write("Podaj nazwę przychodu: ");
            string name = Console.ReadLine()!;

            Console.Write("Podaj kwote: ");
            string text = Console.ReadLine()!;
            if(int.TryParse(text, out int value))
            {
                group.Add(new Income(name, value));
                Console.WriteLine("Dodano przychód");
            }
            else
            {
                Console.WriteLine("Błąd");
                return;
            }
        }

        // USUWANIE ELEMNTU
        private void RemoveItemMenu(HomeBudgetPlannerProxy proxy)
        {
            Console.Clear();
            Console.WriteLine("[USUWANIE ELEMENTU]\n");

            var items = proxy.GetBudgetItems();

            if (items.Count == 0)
            {
                Console.WriteLine("Brak elementów do usunięcia.");
                Console.ReadKey();
                return;
            }

            for (int i = 0; i < items.Count; i++)
            {
                Console.WriteLine($"{i + 1}. {items[i]}");
            }

            Console.Write("\nWybierz numer elementu do usunięcia: ");
            if (!int.TryParse(Console.ReadLine(), out int choice) ||
                choice < 1 || choice > items.Count)
            {
                Console.WriteLine("Nieprawidłowy wybór.");
                Console.ReadKey();
                return;
            }

            var item = items[choice - 1];
            proxy.RemoveItem(item);
            Console.WriteLine("Element usunięty.");



            Console.ReadKey();
        }



        

        // MENU BUDŻETU
        public void ShowPlan(HomeBudgetPlannerProxy proxy)
        {
                Console.Clear();
                Console.WriteLine("\t\tAPLIKACJA BUDŻETU DOMOWEGO\n");
                Console.WriteLine("[STAN BUDŻETU]\n");
                float totalExpenses = proxy.GetTotalExpense();
                float totalIncome = proxy.GetTotalIncome();
                float balance = proxy.GetBalance();

                Console.WriteLine($"\t\tObecny balans: {balance} zł\n");

                List<BudgetItem> list = proxy.GetBudgetItems();

                foreach(var item in list)
                {
                    Console.WriteLine(item);
                }

                ShowMenu(new List<MenuOption>
            {
                new MenuOption($"Pokaż wydatki  (Łącznie: {totalExpenses} zł)", () => ShowExpensesList(proxy)),
                new MenuOption($"Pokaż przychody (Suma: {totalIncome} zł)", () => ShowIncomesList(proxy)),
                new MenuOption("Wróć", () => { })

            });

        }

        // WYŚWIETLANIE WYDATKÓW
        private void ShowExpensesList(HomeBudgetPlannerProxy proxy)
        {
            Console.Clear();
            Console.WriteLine("[SZCZEGÓŁY WYDATKÓW]\n");

            bool empty = true;
            foreach (var item in proxy.GetBudgetItems())
            {
                if (!(item is Income))
                {
                    Console.WriteLine(item);
                    empty = false;
                }
            }

            if (empty)
            {
                Console.WriteLine("Brak wydatków.");
            }

            Console.WriteLine("\nNaciśnij dowolny przycisk aby wrócić.");
            Console.ReadKey();
        }

        // WYŚWIETLANIE PRZYCHODÓW
        private void ShowIncomesList(HomeBudgetPlannerProxy proxy)
        {
            Console.Clear();
            Console.WriteLine("[SZCZEGÓŁY PRZYCHODÓW]\n");

            bool empty = true;
            foreach (var item in proxy.GetBudgetItems())
            {
                if (item is Income)
                {
                    Console.WriteLine(item);
                    empty = false;
                }
            }

            if (empty)
            {
                Console.WriteLine("Brak przychodów.");
            }

            Console.WriteLine("\nNaciśnij dowolny przycisk aby wrócić.");
            Console.ReadKey();
        }



        // WYBÓR FORMATU PLIKU
        private void ChangeStrategyMenu(HomeBudgetPlannerProxy proxy)
        {
            Console.Clear();
            Console.WriteLine("\t\tAPLIKACJA BUDŻETU DOMOWEGO\n");
            Console.WriteLine("[ZMIANA STRATEGII ZAPISU]\n");
            Console.WriteLine("Wybierz format pliku:");
            ShowMenu(new List<MenuOption>
            {
                new MenuOption("Zapisuj jako .PDF", () =>
                {
                    proxy.SetStrategy(new PDFRaportStrategy());
                    Console.WriteLine("\nNaciśnij dowolny klawisz.");
                    Console.ReadKey();
                }),
                new MenuOption("Zapisuj jako .CSV", () =>
                {
                    proxy.SetStrategy(new CSVRaportStrategy());
                    Console.WriteLine("\nNaciśnij dowolny klawisz.");
                    Console.ReadKey();
                }),
                new MenuOption("Wróć", () => { }) 
            });

        }

        // METODA POMOCNICZA DO WYŚWIETLANIA MENU
        public void ShowMenu(List<MenuOption> options)
        {

            Console.WriteLine("Wybierz opcję:");
            for (int i = 0; i < options.Count; i++)
            {
                Console.WriteLine($"{i + 1}. {options[i].Description}");
            }

            if (int.TryParse(Console.ReadLine(), out int choice) && choice > 0 && choice <= options.Count)
            {
                options[choice - 1].Action?.Invoke();   
            }
            else
            {
                Console.WriteLine("Nieprawidłowy wybór.");
            }
        }
      

    }

    public class MenuOption
    {
        public string? Description {get; set;}
        public Action? Action {get; set;}

        public MenuOption(string description, Action action)
        {
            Description = description;
            Action = action;
        }
    }

}


--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\Expense.cs ---
namespace HomeBudgetProject.Classes
{
    public class Expense : BudgetItem
    {
        public Expense(string name, float value): base(name, value) {}
        public override float GetValue()
        {
            return Value;
        }
        public override string ToString()
        {
            return base.ToString();
        }

    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\HomeBudgetPlanner.cs ---
using HomeBudgetProject.Interfaces;
using System.Text.Json;
using System.IO;
using System.Text;

namespace HomeBudgetProject.Classes
{
    public class HomeBudgetPlanner : IHomeBudgetPlanner
    {
        public bool is_raport_generated = false;
        private readonly string filePath;
        private List<IBudgetObserver> observers = new List<IBudgetObserver>();
        public List<BudgetItem> budgetItemsList = new List<BudgetItem>();
        public IRaportStrategy? raportStrategy;
        public HomeBudgetPlanner(string nickname)
        {
            filePath = $"budget_{nickname}.json";
            raportStrategy = new CSVRaportStrategy();
            LoadBudget();
        }

        public void AddExpense(Expense item)
        {
            budgetItemsList.Add(item);
            Notify();
            SaveBudget();
        }

        public void AddIncome(Income item)
        {
            budgetItemsList.Add(item);
            Notify();
            SaveBudget();
        }

        
        public void AddGroup(BudgetGroup group)
        {
            budgetItemsList.Add(group);
            Notify();
            SaveBudget();
        }

        public void RemoveItem(BudgetItem item)
        {
            budgetItemsList.Remove(item);
            Notify();
            SaveBudget();
        }


        public float GetTotalIncome()
        {
            float total = 0;
            foreach (var item in budgetItemsList)
            {
                if (item is not Expense)
                {
                    total += item.GetValue();
                }
            }

            return total;
        }

        public float GetTotalExpense()
        {
            float total = 0;

            foreach (var item in budgetItemsList)
            {
                if (item is not Income)
                {
                    total += item.GetValue();
                }
            }

            return total;
        }


        public float GetBalance()
        {
            return GetTotalIncome() - GetTotalExpense();
        }

        public List<BudgetItem> GetBudgetItems()
        {
            return budgetItemsList;
        }

        public void Attach(IBudgetObserver observer)
        {
            if (!observers.Contains(observer))
            {
                observers.Add(observer);
            }
        }

        public void Detach(IBudgetObserver observer)
        {
            observers.Remove(observer);
        }

        public void GenerateRaport()
        {
            if (raportStrategy == null)
            {
                throw new InvalidOperationException("Nie ustawiono strategii raportowania!");
            }
            raportStrategy.GenerateRaport(this);
            is_raport_generated = true;
        }

        public void Notify()
        {
            foreach (var observer in observers)
            {
                observer.Update(this);
            }
        }

        public void SetStrategy(IRaportStrategy strategy)
        {
            this.raportStrategy = strategy;
        }


        private void LoadBudget()
        {
            if (File.Exists(filePath) == false) { return; }
            try
            {
                string json = File.ReadAllText(filePath, Encoding.UTF8);
                List<BudgetItem> lista = JsonSerializer.Deserialize<List<BudgetItem>>(json)!;
                if (lista != null)
                {
                    budgetItemsList = lista;
                }
            }
            catch
            {
                budgetItemsList = new List<BudgetItem>();
            }
        }
        private void SaveBudget()
        {
            JsonSerializerOptions option = new JsonSerializerOptions();
            option.WriteIndented = true;
            option.Encoder = System.Text.Encodings.Web.JavaScriptEncoder.UnsafeRelaxedJsonEscaping;

            string content = JsonSerializer.Serialize(budgetItemsList, option);
            File.WriteAllText(filePath, content, Encoding.UTF8);
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\HomeBudgetPlannerProxy.cs ---
using HomeBudgetProject.Enums;
using HomeBudgetProject.Interfaces;

namespace HomeBudgetProject.Classes
{
    internal class HomeBudgetPlannerProxy : IHomeBudgetPlanner
    {
        private HomeBudgetPlanner _realService;
        private User user;

        private Logger logger;

        public HomeBudgetPlannerProxy(User user, HomeBudgetPlanner service)
        {
            this.user = user;
            _realService = service;
            logger = Logger.GetInstance();
        }

        public void AddExpense(Expense item)
        {
            _realService.AddExpense(item);
            logger.Log(LogType.SuccessfulOperation, user, $"Dodano wydatek: {item.Name}");
        }


        public void AddIncome(Income item)
        {
            _realService.AddIncome(item);
            logger.Log(LogType.SuccessfulOperation, user, $"Dodano nowy przychód");
        }

        public void AddGroup(BudgetGroup group)
        {
            _realService.AddGroup(group);
            logger.Log(LogType.SuccessfulOperation, user, $"Dodano nową grupę");
        }

        public void RemoveItem(BudgetItem item)
        {

            _realService.RemoveItem(item);
            logger.Log(LogType.SuccessfulOperation, user, $"Usunięto element: {item.Name}");

        }


        public float GetTotalIncome()
        {
            return _realService.GetTotalIncome();
        }

        public float GetTotalExpense()
        {
             return _realService.GetTotalExpense();
        }
        public float GetBalance()
        {
             return _realService.GetBalance();
        }
        public List<BudgetItem> GetBudgetItems()
        {
            return _realService.GetBudgetItems();
        }

        public void Attach(IBudgetObserver observer)
        {
            _realService.Attach(observer);
        }

        public void Detach(IBudgetObserver observer)
        {
            _realService.Detach(observer);
        }

        public void Notify()
        {
            _realService.Notify();
        }

        public void GenerateRaport()
        {
            if (!HasPermission(nameof(GenerateRaport)))
            {
                Console.WriteLine("Nie masz uprawnień do generowania raportu");
                logger.Log(LogType.FailedOperation, user, "Nie posiada uprawnień do generowania raportu");
                return;
            }
            _realService.GenerateRaport();
            logger.Log(LogType.SuccessfulOperation, user, $"Wygenerowano raport {_realService.raportStrategy}");
       
        }

        public void SetStrategy(IRaportStrategy strategy)
        {
            if (!HasPermission(nameof(SetStrategy)))
            {
                Console.WriteLine("Nie masz uprawnień do zmiany formatu raportu");
                logger.Log(LogType.FailedOperation, user, "Nie posiada uprawnień do zmiany formatu raportu");
                return;
            }
            _realService.SetStrategy(strategy);
            logger.Log(LogType.SuccessfulOperation, user, $"Ustawiono format raportu na {strategy}");
        }

        private bool HasPermission(string methodName)
        {
            switch (methodName)
            {
                case "GenerateRaport":
                    if (user.Status < StatusLevel.NormalUser)
                    {
                        return false;
                    }
                    break;
                case "SetStrategy":
                    if (user.Status < StatusLevel.VIP)
                    {
                        return false;
                    }
                    break;
            }
            return true;
        }

        public HomeBudgetPlanner GetRealService()
        {
            return _realService;
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\Income.cs ---
namespace HomeBudgetProject.Classes
{
    public class Income : BudgetItem
    {
        public Income(string name, float value): base(name, value) {}
        public override float GetValue()
        {
            return Value;
        }
        public override string ToString()
        {
            return base.ToString();
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\Log.cs ---
using HomeBudgetProject.Enums;

namespace HomeBudgetProject.Classes
{
    internal class Log
    {
        public LogType logType { get; set; }
        public User user { get; set; }
        public string? description { get; set; }

        public Log(LogType logType, User user, string description)
        {
            this.logType = logType;
            this.user = user;
            this.description = description;
        }

        public override string ToString()
        {
            return $"[{logType}] {user.Nickname} {description}";
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\Logger.cs ---
using HomeBudgetProject.Enums;
using System.Text.Json;

namespace HomeBudgetProject.Classes
{
    internal class Logger
    {
        private string filePath = "system_logs.json";
        private static Logger? _instance;
        private List<Log> logEntries;

        private Logger() {
            logEntries = LoadLogs();
        }

        public static Logger GetInstance()
        {
            if (_instance == null)
            {
                _instance = new Logger();
            }

            return _instance;
        }
        public void Log(LogType logType, User user, string description)
        {
            logEntries.Add(new Log(logType, user, description));
            SaveLogs();
        }

        public void GetLogsForAdmin(User currentUser)
        {
            if (currentUser.Status != StatusLevel.Admin)
            {
                Console.WriteLine("Brak uprawnieďż˝ do przeglďż˝dania logďż˝w systemowych!");
                return;
            }

            int number = 1;
            foreach (Log log in logEntries)
            {
                Console.WriteLine($"{number}. {log}");
                number++;
            }
        }
        private List<Log> LoadLogs()
        {
            if (File.Exists(filePath) == false) { return new List<Log>(); }
            try
            {
                string logs = File.ReadAllText(filePath, System.Text.Encoding.UTF8); //domyslnie bez polskichznakow
                List<Log> loadedLogs = JsonSerializer.Deserialize<List<Log>>(logs);  //Informacja na ďż˝ďż˝to ďż˝e moďż˝e byďż˝ null, ale poniďż˝ej sprawdzenie
                if(loadedLogs == null) {  return new List<Log>(); }
                return loadedLogs;
            }
            catch { return new List<Log>(); }
        }
        private void SaveLogs()
        {
            JsonSerializerOptions options = new JsonSerializerOptions();
            options.WriteIndented = true; // dla ďż˝adnego wyďż˝wietlania
            options.Encoder = System.Text.Encodings.Web.JavaScriptEncoder.UnsafeRelaxedJsonEscaping; //dodatkowo do utf-8
            string logs = JsonSerializer.Serialize(logEntries, options);
            File.WriteAllText(filePath, logs, System.Text.Encoding.UTF8);
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\PDFRaportStrategy.cs ---
using HomeBudgetProject.Interfaces;
using QuestPDF.Fluent;
using QuestPDF.Helpers;
using QuestPDF.Infrastructure;

namespace HomeBudgetProject.Classes
{
    public class PDFRaportStrategy : IRaportStrategy
    {
        public void GenerateRaport(HomeBudgetPlanner planner)
        {
            QuestPDF.Settings.License = LicenseType.Community;

            Document.Create(container =>
            {
                container.Page(page =>
                {
                    page.Size(PageSizes.A4);
                    page.Margin(40);
                    page.DefaultTextStyle(x => x.FontSize(12));

                    page.Content().Column(column =>
                    {
                        column.Item().Text("RAPORT BUDŻETU DOMOWEGO")
                            .FontSize(20)
                            .Bold()
                            .AlignCenter();

                        column.Item().PaddingVertical(10);

                        foreach (var item in planner.budgetItemsList)
                        {
                            RenderItem(column, item, 0);
                        }
                    });
                });
            })
            .GeneratePdf("budget_report.pdf");

            Console.WriteLine("Raport PDF zapisany: budget_report.pdf");
        }

        private void RenderItem(ColumnDescriptor column, BudgetItem item, int indent)
        {
            string prefix = new string(' ', indent * 4);

            if (item is BudgetGroup group)
            {
                column.Item().Text($"{prefix}[GRUPA] {group.Name} | SUMA: {group.GetValue()}")
                    .Bold();

                foreach (var subItem in group.budgetItemList)
                {
                    RenderItem(column, subItem, indent + 1);
                }
            }
            else
            {
                column.Item().Text($"{prefix}{item.Name} -> {item.GetValue()}");
            }
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\User.cs ---
using HomeBudgetProject.Enums;

namespace HomeBudgetProject.Classes
{
    public class User
    {
        public string Nickname { get; set; }
        public string Password { get; set; }
        public StatusLevel Status { get; set; }

        public User(string nickname, string password, StatusLevel level)
        {
            Nickname = nickname;
            Password = password;
            Status = level;
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Classes\UserManager.cs ---
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography;
using System.Text;
using System.Text.Json;
using HomeBudgetProject.Enums;

namespace HomeBudgetProject.Classes
{
    public class UserManager
    {
        private const string FilePath = "users.json";
        private readonly List<User> _users;

        public UserManager()
        {
            _users = LoadUsers();
            EnsureDefaultAdminExists();
        }


        private List<User> LoadUsers()
        {
            if (!File.Exists(FilePath))
            {
                return new List<User>();
            }

            try
            {
                string json = File.ReadAllText(FilePath, Encoding.UTF8);
                var options = new JsonSerializerOptions { PropertyNameCaseInsensitive = true };
                var list = JsonSerializer.Deserialize<List<User>>(json, options);

                return list!;
            }
            catch
            {
                Console.WriteLine("Błąd");
                return new List<User>();
            }
        }

        private void SaveUsers()
        {
            var options = new JsonSerializerOptions { WriteIndented = true };
            string json = JsonSerializer.Serialize(_users, options);
            File.WriteAllText(FilePath, json, Encoding.UTF8);
        }

        private void EnsureDefaultAdminExists()
        {
            if (!_users.Any(u => u.Nickname == "admin"))
            {
                _users.Add(new User("admin", HashPaswd("admin"), StatusLevel.Admin));
                SaveUsers();
            }
        }


        public User? Authenticate(string nickname, string password)
        {
            string hashedPassword = HashPaswd(password);

            return _users.FirstOrDefault(u => u.Nickname == nickname && u.Password == hashedPassword);
        }

        public bool RegisterUser(string nickname, string password, StatusLevel level, string? adminAuthPassword = null)
        {
            if (_users.Any(u => u.Nickname == nickname))
            {
                return false;
            }

            if (level == StatusLevel.Admin)
            {
                if (string.IsNullOrEmpty(adminAuthPassword))
                {
                    return false;
                }

                string hashedAdminAuth = HashPaswd(adminAuthPassword);

                bool isAdminAuthorized = _users.Any(u => u.Status == StatusLevel.Admin && u.Password == hashedAdminAuth);

                if (!isAdminAuthorized)
                {
                    return false; 
                }
            }

            _users.Add(new User(nickname, HashPaswd(password), level));
            SaveUsers();
            
            return true;
        }


        private string HashPaswd(string password)
        {
            using (var sha256 = SHA256.Create())
            {
                byte[] bytes = Encoding.UTF8.GetBytes(password);
                byte[] hash = sha256.ComputeHash(bytes);
                return Convert.ToBase64String(hash);
            }
        }
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Enums\LogType.cs ---
namespace HomeBudgetProject.Enums
{
        public enum LogType
    {
        LogIn,
        LogOut,
        SuccessfulOperation,
        FailedOperation
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Enums\StatusLevel.cs ---
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace HomeBudgetProject.Enums
{
    public enum StatusLevel
    {
        Guest,
        NormalUser,
        VIP,
        Admin
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Interfaces\IBudgetObserver.cs ---
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using HomeBudgetProject.Classes;

namespace HomeBudgetProject.Interfaces
{
    public interface IBudgetObserver
    {
        void Update(HomeBudgetPlanner planer);
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Interfaces\IHomeBudgetPlanner.cs ---
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using HomeBudgetProject.Classes;

namespace HomeBudgetProject.Interfaces
{
    public interface IHomeBudgetPlanner
    {
        void AddIncome(Income item);
        void AddExpense(Expense item);
        void AddGroup(BudgetGroup group);
        void RemoveItem(BudgetItem item);

        List<BudgetItem> GetBudgetItems();
        void GenerateRaport();
        void SetStrategy(IRaportStrategy strategy);
        void Attach(IBudgetObserver observer);
        void Detach(IBudgetObserver observer);
        void Notify();
    }
}

--- KONIEC PLIKU ---

--- START PLIKU: C:\Users\pieci\Desktop\Nowy folder\HomeBudgetPlaner\HomeBudgetProject\Interfaces\IRaportStrategy.cs ---
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using HomeBudgetProject.Classes;

namespace HomeBudgetProject.Interfaces
{
    public interface IRaportStrategy
    {
        void GenerateRaport(HomeBudgetPlanner planner);
    }
}

--- KONIEC PLIKU ---

